<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header(title='Product Details')}">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-100 min-h-screen text-gray-900">

    <!-- Navbar -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <!-- Message -->
    <div th:if="${message}" class="bg-blue-600 text-white text-center py-3 rounded mx-5 my-4">
        <p th:text="${message}"></p>
    </div>

    <!-- Product Card -->
    <div class="max-w-5xl mx-auto my-8 bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-2xl transition-shadow duration-300">
        <div class="md:flex">
            
            <!-- Product Image -->
            <div class="md:w-1/3">
                <img th:if="${product.imageUrl == null}" src="/assets/prod.png" class="w-full h-full object-cover" alt="Product Image">
                <img th:if="${product.imageUrl}" th:src="@{|/${product.imageUrl}|}" class="w-full h-full object-cover" alt="Product Image">
            </div>

            <!-- Product Details -->
            <div class="md:w-2/3 p-6 flex flex-col justify-between gap-4">
                
                <!-- Card Header -->
                <div class="bg-green-600 text-white rounded-lg p-3">
                    <h2 class="text-2xl font-bold" th:text="${product.productName}">Product Name</h2>
                </div>

                <div class="space-y-2">
                    <a th:href="@{/category/{id}/products(id=${product.category.categoryId})}" class="text-green-800 font-semibold hover:underline">
                        Category: <span th:text="${product.category.categoryName}">Category Name</span>
                    </a>

                    <p class="text-gray-700">
                        <strong>Maximum Retail Price:</strong> 
                        <span class="line-through" th:text="${product.maximumRetailPrice}">0.00</span> 
                        <span class="text-green-600 font-bold" th:text="${product.sellingPrice}">0.00</span>
                    </p>

                    <p class="text-gray-800"><strong>Description:</strong> <span th:text="${product.description}">Description</span></p>
                </div>

                <!-- Add to Cart -->
                <form id="addToCartForm" th:action="@{/cart/add}" method="post" class="mt-4 space-y-2">
                    <input type="hidden" th:value="${product.productId}" name="productId" />
                    <input type="hidden" th:value="${product.productName}" name="productName" />
                    <input type="hidden" th:value="${product.maximumRetailPrice}" name="productPrice" />

                    <label for="quantity" class="font-semibold">Quantity</label>
                    <input type="number" id="quantity" name="quantity" min="1" th:max="${product.stockQuantity}" th:value="${quantity}" required
                           class="w-24 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-600" />

                    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">
                        Add to Cart <i class="bi bi-cart"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- You may also like -->
    <div th:replace="~{fragments/headings :: bulletHeading(heading='You may also like')}" class="text-center mb-4"></div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 m-4 justify-items-center">
        <div th:each="i : ${#numbers.sequence(0, products.size() - 1)}" th:insert="~{fragments/cards :: product_card}"
             th:with="productName=${products[i].productName}, sellingPrice=${products[i].sellingPrice}, maximumRetailPrice=${products[i].maximumRetailPrice}, productId=${products[i].productId}, imageUrl=${products[i].imageUrl}">
        </div>
    </div>

    <script>
        // Ensure quantity does not exceed stock
        document.getElementById('quantity').addEventListener('input', function() {
            if (parseInt(this.value) > parseInt(this.getAttribute('max'))) {
                this.value = this.getAttribute('max');
            }
        });
    </script>
</body>
</html>
